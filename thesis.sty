\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{thesis}[2013/11/22 v5.0 Typographic style for a classic-looking thesis]
\RequirePackage{ifthen}
\RequirePackage{verbatim}         % Provide the possibility for multi-line comments
\newboolean{@drafting}            % Activate/Deactivate drafting informations
\newboolean{@eulerchapternumbers} % use AMS Euler for chapter font (otherwise Palatino)
\newboolean{@a5paper}             % use those tiny DIN A5 pages
\newboolean{@minionpro}           % setup for minion pro font
\newboolean{@eulermath}           % use awesome Euler fonts for math
\newboolean{@beramono}            % toggle nice monospaced font (w/ bold) + pre-installed
\newboolean{@layout}              % add a page to the document which shows the layout visually. Cant use in production mode
\newboolean{@colophon}            % Loads the packages which are needed to create a nice colophon page

%---------
% Options
%---------
\DeclareOption{drafting}{\setboolean{@drafting}{true}}
\DeclareOption{eulerchapternumbers}{\setboolean{@eulerchapternumbers}{true}}
\DeclareOption{a5paper}{\setboolean{@a5paper}{true}}
\DeclareOption{minionpro}{\setboolean{@minionpro}{true}}
\DeclareOption{eulermath}{\setboolean{@eulermath}{true}}
\DeclareOption{beramono}{\setboolean{@beramono}{true}}
\DeclareOption{layout}{\setboolean{@layout}{true}}
\DeclareOption{colophon}{\setboolean{@colophon}{true}}
\ProcessOptions\relax

%---------------
% Drafting mode
%---------------
\ifthenelse{\boolean{@drafting}}
{%
    \ifthenelse{\boolean{@layout}}
    {
    	\RequirePackage{layout}
    }{\relax}%
}{%
    \ifthenelse{\boolean{@layout}}
    {
    	\setboolean{@layout}{false}%
    }{\relax}%
}

%----------
% Colophon
%----------
\ifthenelse{\boolean{@colophon}}
{%
    \RequirePackage{hologo}                        % Wird zum rendern des LaTeX und LuLaTeX "Logos" verwendet
    \RequirePackage{ifluatex}                      % Testen ob LuLaTeX installiert ist

    %------------------------------------------------
    % Determine the current running version of LaTeX
    %------------------------------------------------
    \newcommand*{\InfoLaTeX}{%
      \hologo{\fmtname}
    }

    %---------------------------------------------------
    % Determine the current running version of LuaLaTeX
    %---------------------------------------------------
    \newcommand*{\InfoTeX}{%
	    \ifluatex%
		    \hologo{LuaTeX}-%
      	    \begingroup
			    \count@=\luatexversion
			    \divide\count@ by 100 %
			    \edef\x{\the\count@}%
			    \count@=-\x\relax
			    \multiply\count@ by 100 %
			    \advance\count@ by \luatexversion
			    \x.\the\count@.\luatexrevision
		    \endgroup
	    \fi%
    }%
}


%--------
% Colors
%--------
\RequirePackage{xcolor}

%------------
% Font stuff
%------------

% mikrotypographische Optimierungen
\ifthenelse{\boolean{@drafting}}
{% Drafting mode enabled
    \PackageInfo{thesis}{Setting document in "Draft" mode.}%
    \PassOptionsToPackage{draft}{microtype}
}
{% Drafting mode disabled
    \PackageInfo{thesis}{Setting document in "Final" mode.}%
    \PassOptionsToPackage{final}{microtype}
}
\RequirePackage{microtype}

% specialists: MinionPro
\ifthenelse{\boolean{@minionpro}}%
{%
    % in order have Euler math fonts work with Minion, special option is needed
    \ifthenelse{\boolean{@eulermath}}%
    {%
        \PassOptionsToPackage{opticals,mathlf,onlytext}{MinionPro}%
        \RequirePackage{MinionPro} %  opticals, fullfamily, osf
    }{%
        \PassOptionsToPackage{opticals,mathlf}{MinionPro}%
        \RequirePackage{MinionPro} %  opticals, fullfamily, osf
    }
}{%
    % default: Palatino
    \PassOptionsToPackage{osf,sc}{mathpazo}%
    \RequirePackage{mathpazo} % Palatino with real small caps and old style figures
    \linespread{1.05} % a bit more for Palatino
}

\ifthenelse{\boolean{@beramono}}%
{%
    \PassOptionsToPackage{scaled=0.85}{beramono}%
    \RequirePackage{beramono}%
}{%

    \setmonofont[Scale=0.75]{Source Code Pro Light}
    % put your own suitable typewriter font here
    %\renewcommand{\ttdefault}{\rmdefault}
}

\ifthenelse{\boolean{@eulermath}}%
{%
    \PassOptionsToPackage{euler-digits}{eulervm}%
    \RequirePackage{eulervm}% Euler math fonts
}
{\relax}%

% Euler eurb10 / Palatino OSF pplr9d / Palatino SC pplrc9d
% Latin Modern cork-lmr10 / Minion MinionPro-Regular-osf-t1
% (MinionPro-SemiboldCapt-osf-t1 MinionPro-SemiboldDisp-osf-t1)
\ifthenelse{\boolean{@eulerchapternumbers}}% font for the chapter numbers
{%
    \newfont{\chapterNumber}{eurb10 scaled 7000}%
}{%
    \newfont{\chapterNumber}{pplr9d scaled 7000}
}

%-----------
% Own Stuff
%-----------
% Disable single lines at the start of a paragraph (Schusterjungen)
\clubpenalty = 10000

% Disable single lines at the end of a paragraph (Hurenkinder)
\widowpenalty = 10000
\displaywidowpenalty = 10000 % formulas
% Size of the textblock
%-----------------------
\@ifpackageloaded{typearea}%
{\relax}
{%
    \RequirePackage{typearea}%
}
\ifthenelse{\boolean{@a5paper}}%
{% A5
    \ifthenelse{\boolean{@minionpro}}%
    {% Minion gets some extra sizes
	    \PackageInfo{classicthesis}{A5 paper, MinionPro}%
        \areaset[current]{278pt}{556pt}%
	    \setlength{\marginparwidth}{5em}%
    	\setlength{\marginparsep}{1.25em}%
    }{% Palatino or other
        \PackageInfo{classicthesis}{A5 paper, Palatino or other}%
        \areaset[current]{288pt}{555pt}%
        \setlength{\marginparwidth}{4em}%
        \setlength{\marginparsep}{1.25em}%
    }%
}{% A4
    \ifthenelse{\boolean{@minionpro}}%
    {% Minion gets some extra sizes
        \PackageInfo{classicthesis}{A4 paper, MinionPro}%
        \areaset[current]{312pt}{684pt}% 609 + 33 + 42 head \the\footskip
        \setlength{\marginparwidth}{7.5em}%
        \setlength{\marginparsep}{2em}%
    }
    {% Palatino or other
	    \PackageInfo{classicthesis}{A4 paper, Palatino or other}
	    \areaset[current]{336pt}{750pt} % ~ 336 * factor 2 + 33 head + 42 \the\footskip
%   	\areaset{336pt}{761pt} % 686 (factor 2.2) + 33 head + 42 head \the\footskip 10pt
		\setlength{\marginparwidth}{7em}%
        \setlength{\marginparsep}{2em}%
    }%
}
% Here are some suggestions for the text widths and heights:
% Palatino 	10pt: 288--312pt | 609--657pt
% Palatino 	11pt: 312--336pt | 657--705pt
% Palatino 	12pt: 360--384pt | 768pt
% Minion 	  10pt: 264--288pt | 561--609pt
% Minion 	  11pt: 288--312pt | 609--657pt
% Minion 	  12pt: 336pt      | 672pt
% Libertine 10pt:
% Libertine 11pt:
% Libertine 12pt:
% kpfonts 10pt:
% kpfonts 11pt:
% kpfonts 12pt: